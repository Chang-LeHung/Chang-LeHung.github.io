# OpenMP 任务模型规范

- untied 指令
  - 如果一个任务用 untied 修饰，那么这个任务在被一个线程挂起之后可以被另外的一个线程唤醒。
  - 如果一个任务没有使用 untied 的修饰默认是 tied ，当这个任务被挂起的时候。
  - 如果一个任务是最终任务或者包含任务，那么 untied 将会被忽略，这个任务是 tied 任务。
- final 指令
  - 包含任务是最终任务的子孙任务。
  - find 指令的条件等于 true 的时候，任务成为 final 任务，任务将被线程立即执行不会将其放入到任务池当中进行调度。

## 任务的语意

- 当线程遇到一个 task 子句的时候，一个显式的任务就会被创建，会有一个数据环境 (data environment) 和任务进行关联，当任务执行完成之后，与任务关联的数据环境就会被摧毁。
- 如果在一个任务当中生成一个任务，这个内部任务并不是外部任务的一部分，除非这个内部任务是包含任务。
- 当线程遇到一个任务的时候可以立即执行，也可以放到任务池当中进行调度然后再执行。
- 每一个显式任务在他关联的代码块的最后有一个任务调度点，可以让改任务执行完成之后调度其他的任务

## 任务调度

任务调度点将任务区域分成不同的部分，每个部分的执行是不能够被打断的，不同的部分的执行顺序必须按照定义的顺序执行。当没有使用具有同步语意的指令时，不同的任务的执行顺序是没有规定的

- 当一个线程到达一个任务调度点的时候，可能会做一个任务的切换，开始执行或者恢复执行一个不同的任务。
- 当一个线程遇到一个任务调度点的时候，开始执行一个绑定任务。
- 当一个线程遇到一个任务调度点的时候，恢复任何一个绑定任务的执行。
- 当一个线程遇到一个任务调度点的时候，开始执行一个非绑定任务。
- 当一个线程遇到一个任务调度点的时候，恢复执行任何一个非绑定的任务。
- 如果遇到上述情况的多个，选择哪一个没有规定！！！！

## 任务调度的限制

- 一个依赖任务只有等到他的所有以来都满足之后才能够被调度。
- 当一任务的互斥任务正在被执行，那么该任务不能够被调度。

实验测试：

一个线程在执行一个任务的时候不会切换到另外一个任务执行，不管是否是绑定任务还是非绑定任务！但是如果一个任务是非绑定任务的时候，如果他没有正在被执行，那么就是可以被其他线程恢复执行。
